<!DOCTYPE html>
<html>

<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre&display=swap" rel="stylesheet">
    <style type="text/css">
    html,
    body {
        height: 100%;
        margin: 0px;
        padding: 0px;
        font-family: 'Frank Ruhl Libre', serif;
    }

    #text {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(50px);
    }

    .line {
        margin-bottom: 10px;
    }

    .line:not(#first) {
        display: none;
    }

    #canvas {
        position: absolute;
    }

    .container {
        position: absolute;
        z-index: -1;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .canvas {
        position: absolute;
    }

    .canvas--shape {
        z-index: 1;
        opacity: 0;
    }

    #text {
        position: relative;
        top: 50%;
        transform: translateY(-50%);
        text-align: center;
        padding: 10%;
    }

    .red {
        color: darkblue;
    }

    a {
        font-weight: bolder;
    }

    a:link {
        text-decoration: none;
        color: blue;
    }

    a:visited {
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    a:active {
        text-decoration: underline;
    }
    </style>
    <title>Thorn Baby</title>
</head>

<body>
    <!-- <div class="container">
        <canvas class="canvas canvas--shape js-canvas" width="500" height="500"></canvas>
        <canvas class="canvas js-canvas-2" width="500" height="500"></canvas>
    </div> -->
    <canvas id="canvas"></canvas>
    <div id="text">
        <div class="line" id="first">She gives <a href="#" onclick="clicked(this)">birth</a> to <a href="#" onclick="clicked(this)">prickles</a>.</div>
        <div class="line" id="birth">She births them with noble purposes: <i>you are designed to <a href="#" onclick="clicked(this)">protect</a>.</i></div>
        <div class="line" id="prickles">Lines <a href="#" onclick="clicked(this)">stems</a> with hooked <a href="#" onclick="clicked(this)">daggers</a>.</div>
        <div class="line" id="stems">Her <a href="#" onclick="clicked(this)">babies</a> protrude from the epidermis, spread across until the <a href="#" onclick="clicked(this)">surface</a> is more prickly outgrowth than sweetness.</div>
        <div class="line" id="daggers">What she doesn't mention is how her children curve down, hooks waiting to sink into neighboring plants, monopolize sunlight, starve out the <a href="#" onclick="clicked(this)">others</a>.</div>
        <div class="line" id="babies"><i>Don't grow up too pretty</i>, she tells them, an over-concerned mother who knows her uterus can only
            expel the ugly.</div>
        <div class="line" id="others"><i>Don't grow up too pretty.</i></div>
        <div class="line" id="surface">They house fungi, sporotrichosis, a last line of defense, because she will not be there to protect them.</div>
        <div class="line" id="protect">She has never been there to protect them.</div>
    </div>
</body>
<script type="text/javascript">
window.onload = function() {
    drawTriangle();
};

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
canvas.height = document.body.clientHeight;
canvas.width = document.body.clientWidth;

function clicked(clickedElement) {
    let key = clickedElement.textContent;
    var element = document.getElementById(key);
    if (element) {
        //let nextDivElement = textMapping[key];
        //autoAnimate = !autoAnimate;
        console.debug(key + " clicked");
        [].forEach.call(document.querySelectorAll('.line'), function(el) {
            el.classList.remove('red');
        });
        element.classList.add("red");
        element.style.display = "block";

        if (allElementsVisible()) {
            reset();
        }

        if (key == "birth") {
            autoSpeedIncrement *= 5;
            console.debug("Increase speed: " + autoSpeedIncrement);
        } else if (key == "prickles" || key == "daggers" || key == "stems") {
            autoPhaseIncrement *= 5;
        } else if (key == "protect" || key == "others" || key == "surface") {
            padding *= 5;
            console.debug("padding: " + padding);
        } else {}
    }
}

function reset() {
    console.debug("Resetting");
    autoSpeedIncrement = 0.005;
    autoPhaseIncrement = 0.002;
    padding = 10;
}

function drawTriangle() {
    let coordinates = generateTriangleCoordinates(0, 0, 50,50, 50, 10);
    console.debug(coordinates)
    animateLines("triangle", ctx, coordinates);// width = 1, color = "black", opacity = 1, i = 0, callback = null)
}

function allElementsVisible() {
    let lines = document.querySelectorAll('.line');
    for (const el of lines) {
        let style = window.getComputedStyle(el);
        if (style.display === 'none') {
            console.debug("Not all visible " + el.id);
            return false;
        }
    }
    return true;
}


function drawLine(ctx, startx, starty, endx, endy, color = "black", width = 10) {
    // Stroked triangle
    ctx.beginPath();
    ctx.moveTo(startx, starty);
    ctx.lineTo(endx, endy);
    ctx.closePath();
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.stroke();
}

function animateLines(reqID, context, coordinates, width = 1, color = "black", opacity = 1, i = 0, callback = null) {
    setLine(context, i, coordinates, width, color, opacity);
    i += 1;

    if (i > (coordinates.length - 1)) {
        //console.log("greater than")
        if (callback) {
            //console.log("Callback!")
            callback();
        }
        cancelAnimationFrame(window["requestID" + reqID]);
        //console.log("Cancel animateLInes")

    } else {
        window["requestID" + reqID] = requestAnimationFrame(function() {
            animateLines(reqID, context, coordinates, width, color, opacity, i, callback);
        });
    }
}

function setLine(context, i, coords, width, color, opacity) {
    context.lineWidth = width;
    context.strokeStyle = color;
    context.globalAlpha = opacity;
    context.beginPath();
    if (i == 0) {
        context.moveTo(coords[i][0], coords[i][1]);
        context.lineTo(coords[i + 1][0], coords[i + 1][1]);
    } else {
        context.moveTo(coords[i - 1][0], coords[i - 1][1]);
        context.lineTo(coords[i][0], coords[i][1]);
    }
    context.closePath();
    context.stroke();
}

function generateCoordinates(start, end, step = 1, horizontal, extraCoord) {
    var coords = []
    for (var i = start; i < end; i += step) {
        if (horizontal) {
            coords.push([i, extraCoord]);
        } else {
            coords.push([extraCoord, i]);
        }
    }
    return coords;
}

/**
 * [generateDiagonalCoordinates description]
 * @param  {Object} startEnd {"start":[x,y],"end":[x1,y1]}
 * @return {[type]}          [description]
 */
function generateDiagonalCoordinates(startEnd, step = 1, keepXEnd = true, keepYEnd = true) {

    var start = startEnd["start"];
    var end = startEnd["end"];
    var newX = start[0];
    var newY = start[1];
    var coords = [start];
    if (end[0] > start[0]) {
        addX = step;
    } else {
        addX = -step;
    }
    if (end[1] > start[1]) {
        addY = step;
    } else {
        addY = -step;
    }
    while ((newX != end[0] && keepXEnd) && (newY != end[1]) && keepYEnd) {
        newX = newX + addX;
        newY = newY + addY;
        coords.push([newX, newY]);

    }
    //console.log(coords);
    return coords;
}

function generateTriangleCoordinates(point1x, point1y, point2x, point2y, point3x, point3y) {
    var firstLeg = generateDiagonalCoordinates({ "start": [point1x, point1y], "end": [point2x, point2y] });
    console.debug(firstLeg);
    let secondLeg = generateDiagonalCoordinates({ "start": [point2x, point2y], "end": [point3x, point3y] });
    console.debug(secondLeg);
    let thirdLeg = generateDiagonalCoordinates({ "start": [point1x, point1y], "end": [point3x, point3y] });
    console.debug(thirdLeg);
    return firstLeg.concat(secondLeg).concat(thirdLeg);
}
</script>

</html>