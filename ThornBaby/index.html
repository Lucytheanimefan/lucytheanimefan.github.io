<!DOCTYPE html>
<html>

<head>
    <style type="text/css">
    html,
    body {
        height: 100%;
        margin: 0px;
        padding: 0px;
    }

    .line:not(#first) {
        display: none;
    }

    .container {
        position: absolute;
        z-index: -1;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .canvas {
        position: absolute;
    }

    .canvas--shape {
        z-index: 1;
        opacity: 0;
    }

    #text {
        position: relative;
        top: 50%;
        transform: translateY(-50%);
        text-align: center;
        padding: 1rem;
    }

    .red {
        color: red;
    }

    a {
        color: black;
    }
    </style>
    <title>Thorn Baby</title>
</head>

<body>
    <div class="container">
        <canvas class="canvas canvas--shape js-canvas" width="500" height="500"></canvas>
        <canvas class="canvas js-canvas-2" width="500" height="500"></canvas>
    </div>
    <div id="text">
        <div class="line" id="first">She gives <a href="#" onclick="clicked(this)">birth</a> to <a href="#" onclick="clicked(this)">prickles</a>.</div>
        <div class="line" id="birth">She births them with noble purposes: <i>you are designed to <a href="#" onclick="clicked(this)">protect</a>.</i></div>
        <div class="line" id="prickles">Lines <a href="#" onclick="clicked(this)">stems</a> with hooked <a href="#" onclick="clicked(this)">daggers</a>.</div>
        <div class="line" id="stems">Her <a href="#" onclick="clicked(this)">babies</a> protrude from the epidermis, spread across until the <a href="#" onclick="clicked(this)">surface</a> is more prickly outgrowth than sweetness.</div>
        <div class="line" id="daggers">What she doesn't mention is how her children curve down, hooks waiting to sink into neighboring plants, monopolize sunlight, starve out the <a href="#" onclick="clicked(this)">others</a>.</div>
        <div class="line" id="babies">Don't grow up too pretty, she tells them, an over-concerned mother who knows her uterus can only
            expel the ugly.</div>
        <div class="line" id="others"><i>Don't grow up too pretty.</i></div>
        <div class="line" id="surface">They house fungi, sporotrichosis, a last line of defense, because she will not be there to protect them.</div>
        <div class="line" id="protect">She has never been there to protect them.</div>
    </div>
</body>
<script type="text/javascript">
const text = "She gives birth to prickles. Lines stems with hooked daggers. Her babies protrude from the epidermis, spread across until the surface is more prickly outgrowth than sweetness. They house fungi, sporotrichosis, a last line of defense, because she will not be there to protect them. Don't grow up too pretty, she tells them, an over-concerned mother who knows her uterus can only expel the ugly. She births them with noble purposes: designed to protect. What she doesn't mention is how her children curve down, hooks waiting to sink into neighboring plants, monopolize sunlight, starve out the others.";

const textMapping = {
    "first": "She gives birth to prickles",
    "birth": "She births them with noble purposes: designed to protect.",
    "prickles": "Lines stems with hooked daggers.",
    "stems": "Her babies protrude from the epidermis, spread across until the surface is more prickly outgrowth than sweetness.",
    "daggers": "What she doesn't mention is how her children curve down, hooks waiting to sink into neighboring plants, monopolize sunlight, starve out the others.",
    "babies": "Don't grow up too pretty, she tells them, an over-concerned mother who knows her uterus can only expel the ugly.",
    "surface": "They house fungi, sporotrichosis, a last line of defense, because she will not be there to protect them, never has been.",
    "others": "Don't grow up too pretty.",
    "protect": "They house fungi, sporotrichosis, a last line of defense, because she will not be there to protect them, never has been."
};

function clicked(clickedElement) {
    let key = clickedElement.textContent;
    if (textMapping[key]) {
        //let nextDivElement = textMapping[key];
        console.debug(key + " clicked");
        var lines = document.getElementsByClassName("line");
        [].forEach.call(document.querySelectorAll('.line'), function(el) {
            el.classList.remove('red');
        });
        document.getElementById(key).classList.add("red");
        document.getElementById(key).style.display = "block";
    }
}


// Canvas stuff
const map = (value, start1, stop1, start2, stop2) => ((value - start1) / (stop1 - start1)) * (stop2 - start2) + start2;
const q = sel => document.querySelector(sel);

const canvas = q('.js-canvas');
const ctx = canvas.getContext('2d');

const canvas2 = q('.js-canvas-2');
const ctx2 = canvas2.getContext('2d');

const w = 500;
const h = 500;
const wh = w * 0.5;
const hh = h * 0.5;

canvas.width = canvas2.width = w;
canvas.height = canvas2.height = h;

const MAX_LINES = 100;
const MAX_SHAPES = 20;

let steps = MAX_LINES;
let shapes = MAX_SHAPES;

let percentX = 1;
let percentY = 1;

let phase = 0;
let autoSpeed = 0;
let autoAnimate = true;

const drawLine = (color, from, to) => {
    ctx.beginPath();
    ctx.lineWidth = 0.25;
    ctx.strokeStyle = color;
    ctx.moveTo(from.x, from.y);
    ctx.lineTo(to.x, to.y);
    ctx.stroke();
    ctx.closePath();
};

const drawShape = (hue = '0', rotation = 0, percent = 1) => {
    const padding = 10;
    const lineWidth = wh - padding;
    const spacing = lineWidth / steps;

    const scale = 0.1 + (0.9 * (1 - percent));
    const alpha = 0.1 + (0.5 * (1 - percent));

    ctx.beginPath();
    ctx.strokeStyle = `hsla(${hue}, 100%, 20%, 0.2)`;
    ctx.fillStyle = `hsla(${hue}, 100%, 20%, 0.01)`;

    ctx.moveTo(0, padding);
    ctx.lineTo(wh * 0.3, hh * 0.7);
    ctx.lineTo(wh - padding, hh);

    ctx.stroke();
    ctx.closePath();


    ctx.beginPath();
    ctx.fillStyle = `hsla(${hue}, 100%, 40%, 0.25)`;
    ctx.arc(lineWidth, wh, 2, 0, Math.PI * 2, false);
    ctx.fill();
    ctx.closePath();

    for (let i = 0; i < steps; i++) {
        const lineColor = `hsla(${hue}, 100%, 25%, ${alpha})`;

        const from = { x: spacing * i, y: hh };
        const to = { x: 0, y: padding + (spacing * i) };

        drawLine(lineColor, from, to);
    }

    ctx2.save();
    ctx2.translate(wh, hh);
    ctx2.rotate(rotation);
    ctx2.scale(scale, scale);

    const a = (Math.PI * 2) / 4;

    for (let i = 0; i < 4; i++) {
        ctx2.rotate(a);
        ctx2.drawImage(canvas, 0, 0, w, h, 0, -hh, w, h);
    }

    ctx2.restore();
};

const clear = (context) => {
    context.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
};

const draw = () => {
    for (let i = 0; i < shapes; i++) {
        const rotation = phase + ((Math.PI * 2) / shapes) * i * percentX;
        const percent = i / (shapes - 1);
        const hue = 90 + (300 * percent);

        drawShape(hue, rotation, percent);
    }
};

const loop = () => {
    clear(ctx);
    clear(ctx2);

    draw();

    if (autoAnimate) {
        console.debug("Auto animate");
        const x = Math.cos(autoSpeed);
        const y = Math.sin(Math.PI + autoSpeed);


        percentX = map(x, -1, 1, 0, 1);
        percentY = map(y, -1, 1, 0, 1);
    }
    else
    {
        console.debug("No auto animate");
    }

    steps = 2 + Math.ceil((MAX_LINES - 2) * percentY);
    phase += 0.002;
    autoSpeed += 0.005;

    requestAnimationFrame(loop);
};

loop();

const onPointerMove = (e) => {
    if (autoAnimate) {
        return;
    }

    const event = (e.touches && e.touches.length) ? e.touches[0] : e;
    const { clientX, clientY } = event;

    const x = clientX;
    const y = clientY;

    percentX = x / document.body.offsetWidth;
    percentY = y / document.body.offsetHeight;
};

const onPointerOver = () => {
    autoAnimate = false;
};

const onPointerLeave = () => {
    autoAnimate = true;
};

document.body.addEventListener('mousemove', onPointerMove);
document.body.addEventListener('touchmove', onPointerMove);

document.addEventListener('mouseenter', onPointerOver);
document.addEventListener('touchstart', onPointerOver);

document.addEventListener('mouseleave', onPointerLeave);
document.addEventListener('touchend', onPointerLeave);
</script>

</html>